---
layout: post
title: "[SAP] ABAP 開発環境をインストールする Part3"
date: 2010-12-26 17:02:36.000 +09:00
categories:
- SAP
tags:
- ABAP
- MaxDB
- NetWeaver
---

前回ので SAP NetWeaver ABAP のインストールは完了しました。ちなみに、試用版のインストールにおける傾向と対策は、下記のような感じでしょうか。

 
- そもそも SAPinst が起動しない <br />
→ OS など、環境が対応していない <br />
→ JRE が入っていない <br />
→ アンチウイルス <br />
→ 偶然（サーバー再起動で直ったりします） 
- Windows ユーザー作成 <br />
→ パスワードポリシー 
- NetWeaver 起動 <br />
→ メモリ不足 <br />
→ TCP ポートの競合 <br />
→ ネットワーク関連 <br />
→ 偶然 

 
エラーの原因は様々なので、結局はイベントログや、NetWeaver の起動ログなどを見て調べることになります。検索エンジンで検索すると、SDN のフォーラムなどがヒットすることもよくあります。必ず英単語で検索しましょう。

 
次に MaxDB の GUI クライアントツールと SAP GUI をインストールします。前者はゲスト OS、後者はホスト OS にインストールします。

 
MaxDB の GUI クライアントツールは 2 種類あり、今回ダウンロードした試用版には、Database Manager と、MaxDB Database Studio の両方のインストーラが含まれています。用途は同じなので、どちらか一つをインストールすれば十分です。後者の Database Studio の方が新しく、機能も多いです。しかしDatabase Studio は、Eclipse のプラグインとして開発されており、Database Manager より高負荷です。試用版ではどちらも 32bit ですが、Database Studio は 64bit 版があったりと、それなりに有利な点もあるのですが、起動/停止や、各種パラメータ設定などの基本的な機能は Database Manager でも当然行えます。32bit しかリリースされていませんが、64bit OS でも問題なく動きます。そんなわけで、Database Manager をインストールします。

 
以下のインストーラを実行して、ウィザードに従って進めるだけです。 <br />
MAXDBTOOLS\DBM76.exe

 
参考までに、Database Studio のインストーラは下記のファイルです。 <br />
MAXDBTOOLS\maxdb-studio-desktop-win-32bit-i386-7_8_01_16\SDBSETUP.exe

 
次に、SAP GUI をインストールします。今回はホスト OS に入れますが、もちろんゲスト OS に入れても動きます。NetWeaver 7.02 の試用版に同梱されているのは最新版の SAP GUI 7.2 のようです。7.2 は Windows 7 にも対応しており、もちろん NetWeaver 7.00 や R/3 などの過去の SAP 製品にログオンすることも可能です。インストーラは下記ｊのファイルです。

 
GUI\SAP_GUI_FOR_WINDOWS_720_PL3_CORE\SAP_GUI_for_Windows_7.20_PL3_CORE_Components.exe

 
なお、これは正式には SAP GUI for Windows というアプリケーションで、SAP GUI for Java と SAP GUI for HTML というアプリケーションも存在しています。for Java は 今回の NetWeaver 7.02 Trial にも入っています。名前の通り Java アプリケーションなので、Windows 以外にも Linux や Macintosh でも動くと思います。試したことはないですが。SAP GUI for HTML は、Web アプリケーションで、これは NetWeaver ABAP の機能の一つなので、特にインストールすることなく、誰でも使えます。微妙に設定が必要ですが、規定の URL にアクセスするだけです。

 
SAP GUI のインストールもウィザードに従って進めていくだけで、特筆すべきところはなしです。

 
以上でインストール作業は完了です。

 
細かい操作手順については、そのうち書いていく予定ですが、とりあえず起動/停止の手順と、SAP GUI 操作の初歩の初歩を紹介します。

 
まずは NetWeaver の起動/停止。方法はいろいろありますが、GUI を使った基本的な操作から。

 
NetWeaver をインストールし終わると、デスクトップに SAP Management Console というショートカットができます。これが SAP の GUI 管理ツールです。MMC のスナップインとして自動的にインストールされています。SAPMMC と呼ばれることが多いです。&#x5b;ファイル名を指定して実行&#x5d; に sapmmc.msc と入れて実行しても起動できます。

 
![]({{site.assets_url}}2010-12-26-image10.png)

 
MMC スナップインとして追加されている、ということは、そうです、COM です。%SystemRoot%\System32\sapmmc.dll という DLL が存在し、こいつが COM サーバーとして動いています。こいつの仕様が公開されているかどうかはちょっと不明ですが、見たことないです。プログラム的に NetWeaver の起動停止を行ないたい場合は、WSDL が公開されている Web サービスを使うことができます。そもそもコマンドラインツールがあるので、それを使うことが多いです。

 
こんな画面です。直感的に分かると思いますが、三角が起動で、四角が停止です。なお、このツール自体は、Windows サービスである sapstartsrv.exe と SOAP で通信しており、sapstartsrv サービス経由で起動/停止、及び、コンソールに表示されるプロセスのステータス情報の取得などを行なっています。アイコンが緑色だと起動で、黄色は起動/停止中、灰色が停止です。ライセンス期限が切れると赤くなったりと、カラフルなやつです。 <br />
![]({{site.assets_url}}2010-12-26-image11.png)

 
NetWeaver は SAPMMC で停止できますが、MaxDB インスタンスは止まっていません。そこで、インストールした Database Manager を使います。スタートメニューとデスクトップにショートカットができているので、そこから起動します。このツールも、見たとおりに操作すれば OK です。ただし、こちらは最初にインスタンスを登録しなければなりません。今回の NetWeaver 試用版では、以下の情報でインスタンスを登録してください。

 
- データベース名: NSP
- ユーザ名: superdba または control
- パスワード: NetWeaver インストール時に入力したパスワード

 
インスタンスが登録されると、下図のようにインスタンスの情報が出てきます。シンプルで分かりやすいです。ツールバーの赤いボタンで停止、緑のボタンで起動です。 <br />
![]({{site.assets_url}}2010-12-26-image12.png)

 
当然のことですが、停止の時は、NetWeaver が先で、その後にデータベースを止めます。起動はその逆で データベース、NetWeaver の順で起動します。実は NetWeaver も データベースも起動中のまま、OS をシャットダウンしても意外と平気だったりしますが。

 
起動/停止を覚えたところで、次は SAP GUI の操作です。こんな外見です。SAP GUI 7.1 とちょっと見た目が変わりました。 <br />
![]({{site.assets_url}}2010-12-26-image13.png)

 
こちらも MaxDB と同様、インスタンスを自分で追加しなければなりません。Ctrl+N を押すと、新規エントリ画面が表示されるので、ウィザードに従って進めていきます。

 
&#x5b;ユーザ指定システム&#x5d; のまま、&#x5b;次画面&#x5d; をクリックします。 <br />
![]({{site.assets_url}}2010-12-26-image14.png)

 
必要な情報を入力します。今回インストールしたシステムは以下ですので、それを入力します。

 
- システムID: NSP
- インスタンス番号: 00

 
あとはデフォルト設定でよいので、ここで &#x5b;終了&#x5d; をクリックします。

 
![]({{site.assets_url}}2010-12-26-image15.png)

 
システムが追加されました。ダブルクリックすれば起動します。 <br />
![]({{site.assets_url}}2010-12-26-image16.png)

 
ですが、その前に、サーバー側でファイアウォールの設定が必要です。SAP GUI と NetWeaver は DIAG というプロトコルで通信していることは触れましたが、DIAG も TCP の上位プロトコルなので普通にポートを開ければいいです。今回はインスタンス番号が 00 なので、3200 ポートを許可する受信ルールを作れば接続できます。使い方次第では他のポートも開ける必要がありますが、とりあえずここでは 3200 だけ開けます。例えば Web サーバーとしては、HTTP ポート 8000 を使っています。

 
![]({{site.assets_url}}2010-12-26-image17.png)

 
接続するには、SAP GUI に追加したエントリをダブルクリックします。ログオン画面が出てくるので、既定のユーザーアカウントを入力します。以下はその一覧です。 <br />
（クライアント/ユーザー名/パスワード）

 
- 000/SAP*/インストール時に入力したパスワード
- 000/DDIC/インストール時に入力したパスワード
- 001/SAP*/インストール時に入力したパスワード
- 001/DDIC/インストール時に入力したパスワード
- 001/BCUSER/abcd1234

 
クライアントって何、という質問に答えるのはけっこう厄介。独立したデータを持てる、NetWeaver 独自の単位です。データの一部を完全に独立して持つことができ、一方 ABAP プログラムは全てクライアント間で共通です。特に決まった使い方はなく、例えば、1つの検証サーバーを立てておいて、検証用クライアントをたくさん作っておくと、複数のデータでの検証が一つのサーバーで実施できてエコ！みたいな感じです。

 
000 というのは特別なクライアントなので、むやみやたらと変更してはいけません。そんなわけでここでは 001 に ユーザー BCUSER でログオンします。

 
![]({{site.assets_url}}2010-12-26-image18.png)

 
ログオンすると以下の画面が表示されます。 <br />
![]({{site.assets_url}}2010-12-26-image19.png)

 
左上のテキストボックスに、数百と存在する「魔法のおまじない」を入力してエンターキーを押すと、そのおまじないに沿ったプログラムが実行され、NetWeaver のあらゆる機能を使うことができます。ERP であれば、受注や入庫、入金といった基幹システムの画面が出てくるのです。この「魔法のおまじない」のことを、トランザクションコードと呼びます。


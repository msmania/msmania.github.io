---
layout: post
title: "PCI Express x8 スロットに x16 のカードを挿す"
date: 2012-06-03 23:50:45.000 +09:00
categories:
- misc
tags:
- express5800
- geforce
- nvidia
- PCI Express
- sis
- ubuntu
- xorg.conf
---

今まで ubuntu を 1600x900 の解像度で我慢して使ってきたが、やはりディスプレイに合わせて 1920x1080 で使いたいよね、オンボードのグラフィック機能だとインストール直後は 800x600 の解像度しか選べず、xorg.conf で適切なドライバー (sis) を選択してようやく 1600x900 になりました。オンボードだと 1920x1080 は無理なのだろうか、一応できるという情報も見つけたのだけど → [ここ](http://wiki.nothing.sh/page/NEC%20Express5800%A1%BF110Gd/110Gx%20%A5%AA%A5%F3%A5%DC%A1%BC%A5%C9%A5%B0%A5%E9%A5%D5%A5%A3%A5%C3%A5%AF%A5%B9)

 
それと Unity の動きがもっさりしていて、Aero の方がさくさく動くぐらい。これはいけない。ということでグラフィック カードを購入。ついでに前から気になっていた CPU のアップグレード。今どき Pentium Dual Core ってのもね。

 
Ivy Bridge 欲しいなー、と横目で見ながら秋葉原ツクモにて中古品を購入。

 
- Intel Core 2 Quad Q9400 (ファンなし) → 9480 円
- MSI N220GT-MD1G LP (GeForce 220GT + DDR3 1.0GB) → 2780 円 <br />
[http://www.msi-computer.co.jp/products/VGA/N220GT-MD1G_LP.html](http://www.msi-computer.co.jp/products/VGA/N220GT-MD1G_LP.html)

 
グラボはこれ。CPU の写真は撮り忘れた。 <br />
![]({{site.assets_url}}2012-06-03-cimg2779.jpg)

 
別にゲームをするわけでないので、グラボは安物でいいのです。 <br />
CPU に関しては、ソフマップに Q9550 ファン付き 14,000 円のがあってかなり迷ったけど、ケチりました。ファン無しで 12,000 だったら買ったと思う。世間は Ivy Bridge で騒いでいるのに、今どき LGA775 の延命措置とか甚だ時代遅れ感は否めない。

 
サーバー本体はお馴染み NTT-X Store で 12,000 円で買った Express5800/110Ge に、CPU、RAM、HDD を適当に追加して使っています。検証用に SAP ERP 6.0 EhP4 と Solution Manager 7.0 EhP1 を同時に動かしたこともある実力派。いや、まあ遅すぎて使い物にならなかったけど。

 
詳細なスペックはここで↓ <br />
[http://wiki.nothing.sh/page/NEC%20Express5800%A1%BF110Ge](http://wiki.nothing.sh/page/NEC%20Express5800%A1%BF110Ge)

 
CPU は普通に交換するだけなんですが、ここで問題になるのは、<font color="#ff0000">「マザーボードが搭載しているソケットは PCI Express x8 なのに、買ってきたグラボは PCI Express 2.0 x16 である」</font> ということ。x4 やら x8 やらのグラボなんて希少品種過ぎる。

 
手としては、2 通り。それは

 
- ソケットを削る
- グラボを削る

 
以前、[USB 3.0 のカードを挿したとき](http://msmania.wordpress.com/2011/03/06/usb-3-0-%E3%81%AB%E3%82%88%E3%81%86%E3%82%84%E3%81%8F%E5%AF%BE%E5%BF%9C/)は PCI Express 2.0 x16 のスロットに x1 のカードを挿すパターンだったので、何も問題なかったのですが、今回は x8 のスロットに x16 のカードを挿すので、そもそも物理的に無理があるのです。規格上は OK なんですけどね。スロットの形状もフレキシブルにして欲しいところ。

 
簡単なのはグラボを削るほうですが、二度と x16 で使えなくなるので、スロットを頑張って削ることにしました。「PCI スロット 加工」 で検索すると、過去の実績もけっこうあります。

 
普通の小さいカッターと、ライターで熱した金属片を駆使 (スキーワックス用のアイロンはあるけど、半田ごては持っていない) してこんな感じに削りました。ええ、小 1 時間かけて 2 スロット両方やりましたとも。

 ![]({{site.assets_url}}2012-06-03-cimg2775.jpg) ![]({{site.assets_url}}2012-06-03-cimg2776.jpg) 
上から見るとこんな感じです。懐かしの白い PCI スロット。過去には ISA スロットなんてのもありましたね。

 
![]({{site.assets_url}}2012-06-03-cimg2774.jpg)

 
さて、グラボを装着。削ったところにちゃんと入っています。カッターで削っているときに、スロットのピンを何回かガリッとやってしまったので不安です。

 
![]({{site.assets_url}}2012-06-03-cimg2777.jpg) ![]({{site.assets_url}}2012-06-03-cimg2778.jpg)

 
で、おそるおそる電源投入。 <br />
BIOS が起動するまで時間かかるなー、という感じでしたが、煙や火花が散ることはなく、グラボと CPU が無事認識されたようです。加工したスロットは無事だった！しかし、Ubuntu が起動してきません。お決まりですね。 <br />
xorg.conf で sis ドライバーを明示しているのが理由でしょう。ファイルを書き直して再起動すればいいのでしょうが、CPU と GPU を両方変えたこともあって、本当にちゃんと動いているかどうかを使い慣れた Windows で確認することにしました。

 
んで、こんな感じです。

 
![]({{site.assets_url}}2012-06-03-devmgmt.png) ![]({{site.assets_url}}2012-06-03-aida64.png)

 
無事認識されています。が、一つ問題が。グラボが x1 で動作しているのです。

 
結論から言うと、これはそういうものらしいです。

 
先ほどの写真を下に再掲します。[wiki のページ](http://wiki.nothing.sh/page/NEC%20Express5800%A1%BF110Ge#pciex8)によると、写真の左側が #1 、右側が #2 と呼ばれているそうですが、#1 は x1 で動作して、#2 は x4 で動作するらしいのです。おいおいおい。 <br />
じゃあなんで今回は #2 ではなくて #1 に挿してんの、って話なんですが、#2 はスロットを加工しても物理的にダメなのです。wiki にも書いてありますが、#2 スロットの上にある黒い四角いコイルが邪魔で、カードが入りません。こんなところに配線しないで欲しい・・・。

 
![]({{site.assets_url}}2012-06-03-cimg27741.jpg)

 
どうしても性能が欲しくて #2 にカードを挿すときは、こんな手順があるそうです。世の中には猛者と呼ばれる人がいるものですね。もちろん今回は見送ります。

 
- やっぱりグラボを削る
- コイルを削る （！）
- コイルを移動して半田し直す（！！）

 
Windows での確認が取れたので、ubuntu 12.04 を再インストールです。NVIDIA のチップは自動的に認識されて適切なドライバーがロードされるらしく、何の設定をすることもなく 1920x1080 表示になりました。「xorg.conf？ 何だっけそれ？」

 
![]({{site.assets_url}}2012-06-03-screenshot-from-2012-06-03-22-16-30.png)

 
# オンボード デバイスも勝手に認識して欲しいなぁ・・・

